<script>
    console.log("Script gestart: Initialisatie...");

    try {
        // Three.js setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true }); // Antialias voor betere randen
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0xf8f9fa);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap; // Zachtere schaduwen
        renderer.setPixelRatio(window.devicePixelRatio); // Verbeter rendering op high-DPI schermen
        document.body.appendChild(renderer.domElement);

        // Licht toevoegen
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5); // Zacht omgevingslicht
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
        directionalLight.position.set(10, 15, 10);
        directionalLight.castShadow = true;
        directionalLight.shadow.mapSize.width = 2048; // Hogere resolutie voor schaduwmap
        directionalLight.shadow.mapSize.height = 2048;
        directionalLight.shadow.camera.near = 1; // Dichtstbijzijnde afstand van schaduw
        directionalLight.shadow.camera.far = 50; // Verste afstand van schaduw
        directionalLight.shadow.camera.left = -20; // Schaduwcamera instellen
        directionalLight.shadow.camera.right = 20;
        directionalLight.shadow.camera.top = 20;
        directionalLight.shadow.camera.bottom = -20;
        scene.add(directionalLight);

        // Helper toevoegen om lichtposities en schaduwen te debuggen (optioneel)
        // const helper = new THREE.DirectionalLightHelper(directionalLight);
        // scene.add(helper);

        // Ondergrond
        const groundGeometry = new THREE.CircleGeometry(100, 128);
        const groundMaterial = new THREE.MeshStandardMaterial({
            color: 0xffffff,
            roughness: 0.5,
            metalness: 0.1,
        });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // Variabelen
        let model = null;
        const loader = new THREE.GLTFLoader();
        const INITIAL_CAMERA_POSITION = { x: 0, y: 5, z: 20 };

        // OrbitControls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.25;
        controls.maxPolarAngle = Math.PI / 2.1;

        // Camera startpositie
        camera.position.set(INITIAL_CAMERA_POSITION.x, INITIAL_CAMERA_POSITION.y, INITIAL_CAMERA_POSITION.z);
        camera.lookAt(0, 0, 0);

        // Model laden
        loader.load(
            'testcubev2.gltf',
            function (gltf) {
                model = gltf.scene;

                const box = new THREE.Box3().setFromObject(model);
                const size = box.getSize(new THREE.Vector3());
                model.position.set(0, size.y / 2, 0); // Correcte hoogte boven grond

                model.traverse((node) => {
                    if (node.isMesh) {
                        node.castShadow = true;
                        node.receiveShadow = true;
                    }
                });

                scene.add(model);
                console.log("Model geladen.");
            },
            undefined,
            function (error) {
                console.error("Fout bij laden model:", error);
            }
        );

        // Animatie
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

    } catch (err) {
        console.error("Fout tijdens initialisatie:", err);
    }
</script>
